{% extends "base.html" %}
{% load static %}

{% block title %}Poster details{% endblock %}


{% block page_content %}

<h2> Poster details </h2>

<hr />

<h3> Poster </h3>
<b>Language:</b> {{ performance.languoids.all|join:", " }}<br />
<b>Grade Range:</b> {{ performance.grade_range }}<br />
<b>User:</b> {{ performance.user }}<br />
<hr />

<h3> Instructor </h3>
<table>
  <tbody>
{% for instructor in performance.instructors.all %}
    <tr data-id="{{ instructor.id }}">
        <td class="overflow-hidden">
            {{ instructor.firstname }} {{ instructor.lastname }}
        </td>
    </tr>
{% endfor %}
  </tbody>
</table>

<hr />

<h3> Student </h3>
<table class="table table-striped">
    <thead>
        <tr class="row small">
            <th class="col-md-2 overflow-hidden">Student</th>
            <th class="col-md-2 overflow-hidden">Hometown</th>
            <th class="col-md-2 overflow-hidden">Tribe</th>
            <th class="col-md-1 overflow-hidden">Grade</th>
            <th class="col-md-1 overflow-hidden">T-shirt size</th>
        </tr>
    </thead>
    <tbody>
        {% for student in performance.students.all %}
            <tr class="row small" data-id="{{ student.id }}">
                <td class="col-md-2 overflow-hidden">
                    {{ student.firstname }} {{ student.lastname }}
                </td>
                <td class="col-md-2 overflow-hidden">
                    {{ student.hometown }}, {{ student.state }}
                </td>
                <td class="col-md-2 overflow-hidden">
                    {{ student.languoids.all|join:", " }}
                </td>
                <td class="col-md-1 overflow-hidden">
                    {{ student.grade }}
                </td>
                <td class="col-md-1 overflow-hidden">
                    {{ student.tshirt_size }}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<p>
    &nbsp;
</p>
<hr />
<div class="mb-3">
    <a href="edit/" class="btn btn-primary">Edit</a>
    <span>
        <a href="/" class="btn btn-danger">Delete</a>
    </span>
</div>

<script>
    
    const performanceStatusIcon = document.getElementById('performanceStatusIcon');
    const instructorsStatusIcon = document.getElementById('instructorsStatusIcon');
    const instructorsStatusNumber = document.getElementById('instructorsStatusNumber');
    const instructorsStatusDiv = document.getElementById('instructorsStatusDiv');
    const studentsStatusIcon = document.getElementById('studentsStatusIcon');
    const studentsStatusNumber = document.getElementById('studentsStatusNumber');
    const studentsStatusDiv = document.getElementById('studentsStatusDiv');
    const accessoriesStatusIcon = document.getElementById('accessoriesStatusIcon');
    const accessoriesStatusDiv = document.getElementById('accessoriesStatusDiv');
    const reviewStatusIcon = document.getElementById('reviewStatusIcon');
    const reviewStatusDiv = document.getElementById('reviewStatusDiv');
    const approvalStatusIcon = document.getElementById('approvalStatusIcon');
    const approvalStatusDiv = document.getElementById('approvalStatusDiv');

    class App {
    
        constructor() {

            languoidsSelect = document.querySelector('#id_languoids');
            otherLanguoidDiv = document.querySelector('.other_languoid');
        
            performanceStatusIcon.classList.add("text-success")
            // Create a new DOMParser
            var parser = new DOMParser;
            // Parse the encoded string as HTML
            var dom = parser.parseFromString('<!doctype html><body>' + "{{ performance.title }}", 'text/html');
            // Get the decoded string
            var decodedString = dom.body.textContent;
            performanceStatusName.textContent = decodedString;
            
            const numberOfInstructors = "{{ performance.instructors.count }}";
            instructorsStatusNumber.textContent = numberOfInstructors
            if ( numberOfInstructors > 0 ) {
                instructorsStatusIcon.classList.add("text-success")
                instructorsStatusDiv.textContent = "Completed"
            } else if ( "{{ performance.instructors_status }}" == "in_progress" ) {
                    instructorsStatusIcon.classList.add("text-warning")
                    instructorsStatusDiv.textContent = "In progress"
            } else {
                    instructorsStatusIcon.classList.add("text-danger")
                    instructorsStatusDiv.textContent = "Pending"
            }

            const numberOfStudents = "{{ performance.students.count }}";
            studentsStatusNumber.textContent = numberOfStudents
            if ( numberOfStudents > 0 ) {
                studentsStatusIcon.classList.add("text-success")
                studentsStatusDiv.textContent = "Completed"
            } else if ( "{{ performance.students_status }}" == "in_progress" ) {
                    studentsStatusIcon.classList.add("text-warning")
                    studentsStatusDiv.textContent = "In progress"
            } else {
                    studentsStatusIcon.classList.add("text-danger")
                    studentsStatusDiv.textContent = "Pending"
            }

            if ( "{{ performance.accessories_status }}" == "completed" ) {
                accessoriesStatusIcon.classList.add("text-success")
                accessoriesStatusDiv.textContent = "Completed"
            } else if ( "{{ performance.accessories_status }}" == "in_progress" ) {
                accessoriesStatusIcon.classList.add("text-warning")
                accessoriesStatusDiv.textContent = "In progress"
            } else {
                accessoriesStatusIcon.classList.add("text-danger")
                accessoriesStatusDiv.textContent = "Pending"
            }

            if ( "{{ performance.review_status }}" == "completed" ) {
                reviewStatusIcon.classList.add("text-success")
                reviewStatusDiv.textContent = "Completed"
            } else if ( "{{ performance.review_status }}" == "in_progress" ) {
                reviewStatusIcon.classList.add("text-warning")
                reviewStatusDiv.textContent = "In progress"
            } else {
                reviewStatusIcon.classList.add("text-danger")
                reviewStatusDiv.textContent = "Pending"
            }

            if ( "{{ performance.status }}" == "completed" ) {
                approvalStatusIcon.classList.add("text-success")
                approvalStatusDiv.textContent = "Completed"
            } else if ( "{{ performance.status }}" == "in_progress" ) {
                approvalStatusIcon.classList.add("text-warning")
                approvalStatusDiv.textContent = "In progress"
            } else if ( "{{ performance.status }}" == "disqualified" ) {
                approvalStatusIcon.classList.add("text-danger")
                approvalStatusDiv.textContent = "Disqualified"
            } else {
                approvalStatusIcon.classList.add("text-danger")
                approvalStatusDiv.textContent = "Pending"
            }
        
            document.addEventListener('DOMContentLoaded', this._toggleOtherLanguoid.bind(this));

            languoidsSelect.addEventListener('change', this._toggleOtherLanguoid.bind(this));

        }

        _toggleOtherLanguoid(){
            const selectedOptions = Array.from(languoidsSelect.selectedOptions);
            const otherIsSelected = selectedOptions.some(function(option) {
                return option.text === 'Other';
            });

            if (otherIsSelected) {
                // Show the other_languoid div when "Other" is selected
                otherLanguoidDiv.style.display = 'block';
            } else {
                // Hide the other_languoid div when "Other" is not selected
                otherLanguoidDiv.style.display = 'none';
            }
        }

        
    
    }
    const app = new App();
</script>


{% endblock %}
